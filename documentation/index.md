# API documentation

- [Accounts](#accounts)
  - [Service](#service)
    - [Register Service](#register-service)
    - [Get Public Key](#get-public-key)
    - [Get Service (id)](#get-service-id)
    - [Get Service (name)](#get-service-name)
  - [RegisterToken](#registertoken)
    - [Generate Register Token](#generate-register-token)
    - [Validate Register Token](#validate-register-token)
    - [Invalidate Register Token](#invalidate-register-token)
    - [List Register Tokens](#list-register-tokens)
  - [Devices](#devices)
    - [Add](#add)
    - [Add (User)](#add-user)
    - [Modify](#modify)
    - [Revoke](#revoke)
    - [IP](#ip)
    - [Get](#get)
    - [Get (Self)](#get-self)
    - [List](#list)
    - [List (Self)](#list-self)
    - [Delete](#delete)
    - [Delete (Self)](#delete-self)
  - [User](#user)
    - [Add Account](#add-account)
    - [Add Account (admin)](#add-account-admin)
    - [Modify Account](#modify-account)
    - [Modify Account (self)](#modify-account-self)
    - [Delete Account](#delete-account)
    - [Get Account](#get-account)
    - [List Accounts](#list-accounts)
  - [Login/Logout](#loginlogout)
    - [Logout](#logout)
    - [Login](#login)
    - [Login (get Refresh-Token)](#login-get-refresh-token)
    - [Login (use Refresh-Token)](#login-use-refresh-token)

> some API definitions might already have values populated inside their URL. This is because this file is autogenerated from an [Insomnia](https://insomnia.rest) export and Insomnia does not (yet; ref: [#203](https://github.com/getinsomnia/insomnia/issues/203)) support easily editable variables scoped to just a single request. What kind of property the populated value represents should be easy to see or documented in the API endpoint description.

## Accounts

### Service

#### Register Service

```
POST /register
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "data": {
    "name": "analytics",
    "id": "analytics",
    "url": "http://localhost:3008/auth",
    "app": "http://localhost:3008"
  }
}
```

</details>

Register a service as an auth consumer

#### Get Public Key

```
GET /public_key
```

Retrieve the public key used to verify Json Web Tokens. This key is also given by `/register`. This can be used for when registering is not needed (because of default_services) but the public key still needs to be retrieved.

#### Get Service (id)

```
GET /service/by-id/notes
```

Get Service (id)

> get service information by service id

- requires :id
- returns service object

```json
{
  "id": "<service.id>",
  "name": "<service.name>",
  "url": "<service.url>",
  "app": "<service.app>"
}
```

#### Get Service (name)

```
GET /service/by-name/Notes
```

Get Service (name)

> get service information by service name

- requires :name
- returns service object

```json
{
  "id": "<service.id>",
  "name": "<service.name>",
  "url": "<service.url>",
  "app": "<service.app>"
}
```


### RegisterToken

#### Generate Register Token

```
POST /generate-register-token
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "account_type": "privileged"
}
```

</details>

Generates a Register-Token which can be used to give special permissions when creating an account with.

- requires admin privileges

JSON-structure is simple:
```json
{
  "account_type": "<account_type>"
}
```

#### Validate Register Token

```
POST /validate-register-token
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "register_token": "EC93EJyH1Zb9udfwUkXN2plBcSRNnpCnZmb0rHJpZcUUiNG1h4ZhqFSKmZUE2GN13uRWKqEN8B_A92G2HwQp-TvSC2IaLHulTVxDoKvXvyz6z-gXmeVa7D7Ey7EA5ZXXGLd-3Udbbh0-up0HN7_KaUzYpvdQiFy-S-N2Sia4UEjjJHLZDZ3k7qX4ykHVm1Aq9-pHy7QC6pxDDkXQ-AP4czdSiludH7mdAmj9eNCCr2BCFuU8Ng7dU_Ww_xjXdkUIZhPB9Z_OA4HJSbLkrL1DjfnDybIvbmb5Mp-o_jBLH9wy5eUlKo5Br0BDjcRERcZt8VXIOdjZomW0nCfiBIKutb9yzORsen72vZ5gb1uda7RSiS_vNHt_hU4FQTzEmwLlfjaQYwDuZ84YerW2pE51vwWv-xzmMUT5Ns9BWpD529173WNV80OIWaPWge24LN28sr-YwF58iOKsjiOr7wa4JEo6fgA7r_igZP3zHmR06mSls8Qk7RBUpPZy5C-KgEH1QOAIVAufsD6rLZq8ScsvplCPTiSxVi3QMBfVDqIevseLe6mXPlL7w3v-4TOf6E2mewrOZFbN0Ly3Ka20COBoGOxXgR2Xv3MppKraDJkNBEHvWsY6u11BR2slen3Je-DBWYT8xIbwS99Z_op1C-CtQJQ_idEpdaDj-c1FZoE8eh0="
}
```

</details>

Checks the validity of a given Register-Token. Also returns information about the token such as creation date, id and associated account_type.

- **no** admin privileges required

JSON-structure is simple:
```json
{
  "register_token": "<register_token>"
}
```

The response has the following JSON-structure:
```JSON
{
  "message": "<successful|failure>",
  "id": "<id (int)>",
  "timestamp": "<creation date timestamp (int)>",
  "account_type": "<account_type>",
  "permanent": "<permanent (boolean)>",
  "expireAt": "<expireAt (int)>"
}
```

#### Invalidate Register Token

```
DELETE /invalidate-register-token
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "id": "1"
}
```

</details>

Invalidates the given Register-Token. Done via the `id` of the Register-Token since knowing the whole token would be annoying to deal with.

- requires admin privileges


```JSON
{
  "id": "<register_token_id>"
}
```

#### List Register Tokens

```
GET /list-register-tokens
authentication: bearer
```

Lists all the Register Tokens. No payload is required. The data can be found inside the `data`-property inside the response.

- requires admin privileges

The response has the following JSON-structure:
```JSON
{
  "message": "retrieving register token list successful",
  "register_tokens": {
    ...
  },
  "count": <amount of register tokens>,
  "status": "success"
}
```

If an error occurs this the structure is:
```JSON
{
  "message": "<error message>",
  "status": "failure"
}
```


### Devices

#### Add

```
POST /device/
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "ip": "87.155.7.87",
  "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36"
}
```

</details>

Adding a device

With this endpoint users with **admin privileges** can add a new device with a specified ip address and user_agent. This endpoint can optionally add the newly created device to an existing user, to do this add a `user_id` property to the json body.

```json
{
	"ip": "<ip>",
	"user_agent": "<user_agent>"
}
```

**Possible responses**

```json
{
  "message": "successfully added new device",
  "status": "success",
  "device_id": "<device_id>"
}
```

```json
{
  "message": "could not validate requesting users account type",
  "status": "failure",
  "error": <error>
}
```


```json
{
  "message": "failed to add new device",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "supply ip and useragent",
  "status": "failure"
}
```

```json
{
  "message": "account not permitted",
  "status": "failure"
}
```

#### Add (User)

```
POST /device/
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "ip": "127.0.0.1",
  "user_agent": "Insomnia",
  "user_id": 2
}
```

</details>

Adding a device and adding it to a user

With this endpoint users with **admin privileges** can add a new device with a specified ip address and user_agent. This endpoint can optionally just add the device without adding it to a user, to do this just remove the `user_id` property from the json body

```json
{
	"ip": "<ip>",
	"user_agent": "<user_agent>",
  "user_id": "<user_id>"
}
```

**Possible responses**

```json
{
  "message": "successfully added new device",
  "status": "success",
  "device_id": "<device_id>"
}
```

```json
{
  "message": "could not validate requesting users account type",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "failed to add new device to user <user_id>",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "failed to add new device",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "supply ip and useragent",
  "status": "failure"
}
```

```json
{
  "message": "account not permitted",
  "status": "failure"
}
```

#### Modify

```
PATCH /device
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "device_id": "",
  "ip": "",
  "user_agent": ""
}
```

</details>

Modifying a device

With this endpoint users with **admin privileges** can set the ip address and the user_agent of a device.

This is done via the json body:

```json
{
	"device_id": "<device_id>",
	"ip": "<ip>",
	"user_agent": "<user_agent>"
}
```

**Possible responses**

```json
{
  "message": "successfully modified device <device_id>",
  "status": "success",
  "device": {
    ... // this includes ip location data
  }
}
```

```json
{
  "message": "could not validate requesting users account type",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "failed to modify device <device_id>",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "account not permitted",
  "status": "failure"
}
```

#### Revoke

```
PATCH /device/revoke
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "user_id": 2,
  "device_id": "23e8e1ce-8569-11e9-9514-0242ac110006"
}
```

</details>

Revoking device

**Admin usage**

Admin privileges allows specifying user_id for which to revoke the device.

```json
{
  "user_id": <user_id>,
  "device_id": <device_id>
}
```

**Normal usage**

With privileges other than admin the user_id defaults to user id of the requesting user.

```json
{
  "device_id": <device_id
}
```

**Possible responses**

```json
{
  "message": "...",
  "status": "success",
  "is_revoked": <true / false>
}
```

```json
{
  "message": "...",
  "status": "failure",
  "error": <err>
}
```

```json
{
  "message": "...",
  "status": "failure"
}
```

#### IP

```
GET /ip
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "ip": "127.0.0.1"
}
```

</details>

Get information about a specific IP address. This is basically a proxy for the ip-lookup service with the small exception that auth saves the queried IP address and the corresponding data to it's own database.

This endpoint is mostly for debugging / development and is thereby only available to admins.

**Possible responses**

```json
{
  "message": "successfully retrieved ip information",
  "status": "success",
  "data": {
    "ip": "<ip>",
    "continent": "<continent>",
    "continent_code": "<continent_code>",
    "country": "<country>",
    "country_code": "<country_code>",
    "region": "<region>",
    "region_code": "<region_code>",
    "city": "<city>",
    "zip": "<zip>",
    "latitude": <latitude>,
    "longitude": <longitude>,
    "timezone": "<timezone>",
    "timezone_code": "<timezone_code>",
    "isp": <isp>,
    "language": <language[]>,
    "is_anonymous": <true / false>,
    "is_threat": <true / false>,
    "is_internal": <true / false>,
    "creation_date": "2019-06-09T09:05:42.989Z",
    "device_creation_date": "2019-06-09T09:05:42.965Z",
    "is_revoked": <true / false>
  }
}
```

```json
{
  "message": "could not validate requesting users account type",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "failed to retrieve ip information from database",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "failed to retrieve ip information",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "failed to save newly retrieved internal ip information to database",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "failed to save newly retrieved ip information to database",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "account not permitted", 
  "status": "failure"
}
```

#### Get

```
GET /device/2/c28412e6-8a95-11e9-92e1-0242ac110006
authentication: bearer
```

Retrieving information about a specific device.

**Admin usage**

With admin privileges it is possible to retrieve device information for other users identified by the `user_id` in the URL.

`/device/:user_id/:device_id`

**Normal usage**

The `user_id` defaults to the user_id of the requesting user.

`/device/:device_id`

Every request to `/device/:user_id/:device_id` will return in an error with the exception of user_id being the user_id of the requesting user, in this case the endpoint functions just like using `/device/:device_id`.

**Possible responses**

```json
{
  "message": "successfully retrieved device information",
  "device": {
    "device_id": "<device_id>",
    "user_agent": "<user_agent>",
    "ip": "<ip>",
    "continent": "<continent>",
    "continent_code": "<continent_code>",
    "country": "<country>",
    "country_code": "<country_code>",
    "region": "<region>",
    "region_code": "<region_code>",
    "city": "<city>",
    "zip": "<zip>",
    "latitude": <latitude>,
    "longitude": <longitude>,
    "timezone": "<timezone>",
    "timezone_code": "<timezone_code>",
    "isp": <isp>,
    "language": <language[]>,
    "is_anonymous": <true / false>,
    "is_threat": <true / false>,
    "is_internal": <true / false>,
    "creation_date": "2019-06-09T09:05:42.989Z",
    "device_creation_date": "2019-06-09T09:05:42.965Z",
    "is_revoked": <true / false>,
    "user_id": <user_id>,
    "username": "<username>"
  },
  "status": "success"
}
```

```json
{
  "message": "error while getting device information",
  "status": "failure"
}
```

```json
{
  "message": "could not validate requesting users account type",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "error while getting device information",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "error while getting device information",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "account not permitted", 
  "status": "failure"
}
```

#### Get (Self)

```
GET /device/2f6b98a2-82f8-11e9-9246-0242ac110006
authentication: bearer
```

Retrieving information about a specific device.

**Admin usage**

With admin privileges it is possible to retrieve device information for other users identified by the `user_id` in the URL.

`/device/:user_id/:device_id`

**Normal usage**

The `user_id` defaults to the user_id of the requesting user.

`/device/:device_id`

Every request to `/device/:user_id/:device_id` will return in an error with the exception of user_id being the user_id of the requesting user, in this case the endpoint functions just like using `/device/:device_id`.

**Possible responses**

```json
{
  "message": "successfully retrieved device information",
  "device": {
    "device_id": "<device_id>",
    "user_agent": "<user_agent>",
    "ip": "<ip>",
    "continent": "<continent>",
    "continent_code": "<continent_code>",
    "country": "<country>",
    "country_code": "<country_code>",
    "region": "<region>",
    "region_code": "<region_code>",
    "city": "<city>",
    "zip": "<zip>",
    "latitude": <latitude>,
    "longitude": <longitude>,
    "timezone": "<timezone>",
    "timezone_code": "<timezone_code>",
    "isp": <isp>,
    "language": <language[]>,
    "is_anonymous": <true / false>,
    "is_threat": <true / false>,
    "is_internal": <true / false>,
    "creation_date": "2019-06-09T09:05:42.989Z",
    "device_creation_date": "2019-06-09T09:05:42.965Z",
    "is_revoked": <true / false>,
    "user_id": <user_id>,
    "username": "<username>"
  },
  "status": "success"
}
```

```json
{
  "message": "error while getting device information",
  "status": "failure"
}
```

```json
{
  "message": "could not validate requesting users account type",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "error while getting device information",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "error while getting device information",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "account not permitted", 
  "status": "failure"
}
```

#### List

```
GET /devices/1
authentication: bearer
```

Retrieving a list of devices.

**Admin usage**

With admin privileges it is possible to retrieve a list of devices for other users identified by the `user_id` in the URL.

`/devices/:user_id`

**Normal usage**

The `user_id` defaults to the user_id of the requesting user.

`/devices/`

Every request to `/devices/:user_id` will return in an error with the exception of user_id being the user_id of the requesting user, in this case the endpoint does function like just using `/devices/`.

**Possible responses**

```json
{
  "message": "...",
  "status": "success",
  "devices": <devices[]>,
  "count": <count>
}
```

```json
{
  "message": "...",
  "status": "failure",
  "error": <err>
}
```

```json
{
  "message": "...",
  "status": "failure"
}
```

#### List (Self)

```
GET /devices/
authentication: bearer
```

Retrieving a list of devices.

**Admin usage**

With admin privileges it is possible to retrieve a list of devices for other users identified by the `user_id` in the URL.

`/devices/:user_id`

**Normal usage**

The `user_id` defaults to the user_id of the requesting user.

`/devices/`

Every request to `/devices/:user_id` will return in an error with the exception of user_id being the user_id of the requesting user, in this case the endpoint does function like just using `/devices/`.

**Possible responses**

```json
{
  "message": "...",
  "status": "success",
  "devices": <devices[]>,
  "count": <count>
}
```

```json
{
  "message": "...",
  "status": "failure",
  "error": <err>
}
```

```json
{
  "message": "...",
  "status": "failure"
}
```

#### Delete

```
DELETE /device
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "user_id": 1,
  "device_id": "2f6b98a2-82f8-11e9-9246-0242ac110006"
}
```

</details>

Removing a device from an account

**Admin usage**

Admins can delete devices from all accounts, other users can only delete their own devices from their account.

```json
{
	"user_id": <user_id>,
	"device_id": "<device_id>"
}
```

**Normal usage**

As non-admin users cannot delete devices from other users the `user_id` property is not needed. It is not simply ignored, it results in an error unless the supplied user_id is the id of the requesting user.

```json
{
	"device_id": "<device_id>"
}
```

**Possible responses**

```json
{
  "message": "successfully deleted device <device_id>",
  "status": "success"
}
```

```json
{
  "message": "failed to delete device <device_id>",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "could not validate requesting users account type",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "supply device id",
  "status": "failure"
}
```

```json
{
  "message": "account not permitted",
  "status": "failure"
}
```

#### Delete (Self)

```
DELETE /device
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "device_id": "2f6b98a2-82f8-11e9-9246-0242ac110006"
}
```

</details>

Removing a device from an account

**Admin usage**

Admins can delete devices from all accounts, other users can only delete their own devices from their account.

```json
{
	"user_id": <user_id>,
	"device_id": "<device_id>"
}
```

**Normal usage**

As non-admin users cannot delete devices from other users the `user_id` property is not needed. It is not simply ignored, it results in an error unless the supplied user_id is the id of the requesting user.

```json
{
	"device_id": "<device_id>"
}
```

**Possible responses**

```json
{
  "message": "successfully deleted device <device_id>",
  "status": "success"
}
```

```json
{
  "message": "failed to delete device <device_id>",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "could not validate requesting users account type",
  "status": "failure",
  "error": <error>
}
```

```json
{
  "message": "supply device id",
  "status": "failure"
}
```

```json
{
  "message": "account not permitted",
  "status": "failure"
}
```


### User

#### Add Account

```
POST /users/add
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "register-token": "T-r-g6boK5GAHGQo04yz3ziUmoMpOv6OpFpw-MskNs7ncpmYRBP_ZXk9l-08ockblJS7skxKC4bCW_otfDMrbU-kfFGD2z6fE4bnfLNZ2tyCyMWTPhIAMJ4-N5G-4ZZLD4X0l2j-GKqWcXslDElTT5Km32mAxRVsUTMKoVfk22b9Exg7bVzRm9liJ1GdAqDOOWt5r3FKS1N8F4HNcdHdSTeD6GU5pssnMRC4GbZ3f0Dz84z6XGiJyoihZA8esIGOyeaGfi7T7DDQnUioUrVXopXYOy4LfnMYdJ5g_Yt3Mt1ufvzbNeF4BwZ1-YHS0QS1ismPMI4FbeBFbFbdpgf2akeKNCCOz0vF70nQ98xvctre89iAvA13bavlBKgN7_yZgE4Yocgqk-trZOPON1QUiU5cm9Y_vjA3zl7r0LC3j9M8UcJeTwSNbxEBOnGP9pr_FsHPSij02Hr9kBt8MjXVMFQui8MKhWpZqp6BObypvDvU-wtQdNKs8t4c6X0YULMmMY2bPzZVQ538eex5FNLCNMA_T8lYANuTlEe-h2mkPWf1K6nBoPbKq8ppF8-e_nxzPBM-LccBx4zjVHEk8waDsY4QWY9E2v1fKKmWQx0g0qAjNR3nN99dDCVCHkNSJZICB8RWCUwQpDfl5qJc-Ij38PhzGkDZ7HSM3Py_Iwix5TY=",
  "username": "test",
  "email": "test3@jannik.ml",
  "first_name": "<first_name>",
  "last_name": "<last_name>",
  "password": "test",
  "getRefreshToken": true
}
```

</details>

Adds a new account with `account_type="default"`. The new account will be created only when username and email are unique. 

If a `register_token` is specified, the account_type is set accordingly. 

The `add`-request requires* the following JSON structure:
```json
{
  "register_token": "<register_token (optional)>",
	"username": "<username>",
	"email": "<email>",
	"first_name": "<first_name>",
	"last_name": "<last_name>",
	"password": "<password>"
}
```
> *: If not otherwise noted via "(optional)" all given fields are required.

#### Add Account (admin)

```
POST /users/admin/add
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "username": "test",
  "email": "test@jannik.ml",
  "first_name": "first",
  "last_name": "last",
  "password": null,
  "account_type": "default",
  "is_passwordless": true,
  "temp_account": 0
}
```

</details>

Adds a new account with the given values. The new account will be created only when username and email are unique. Requires admin privileges.

The `admin/add`-request requires* the following JSON structure:
```json
{
  "register_token": "<register_token (optional)>",
	"username": "<username>",
	"email": "<email>",
	"first_name": "<first_name>",
	"last_name": "<last_name>",
	"password": "<password>",
  "is_passwordless": "<is_passwordless (optional; default false)>",
  "temp_account": "<temp_account (optional; default 0)>"
}
```
> *: If not otherwise noted via "(optional)" all given fields are required.

#### Modify Account

```
POST /users/modify
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "username": "test",
  "account_type": "privileged"
}
```

</details>

Modify an account. This endpoint allows accounts with `account_type` of `admin` to change accounts. This does include fields like `password`, `first_name`, `last_name`, `email` and even `username`. It is noted that this endpoint is also kind of **dangerous** since modifying ones own account can happen easily. This is somewhat fixed by the newly added `/users/modify-self` route but not totally. 

The required JSON structure is basically the same as used by `/users/add` (excluding `register_token`):
```json
{
	"username": "<username>",
	"email": "<email>"
	"first_name": "<first_name>",
	"last_name": "<last_name>",
	"password": "<password>",
}
```

#### Modify Account (self)

```
POST /users/modify-self
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "first_name": "Jannik1",
  "last_name": "Wibker"
}
```

</details>

Modify the own account. This endpoint allows any kind of account to modify itself. This includes fields like `password`, `first_name` and `last_name`. The fields `email` and `username` cannot be modified unless the requesting user has an account status of `admin`.

The required JSON structure is basically the same as used by `/users/add` (excluding `register_token`, `email` and `username` (last two only for non-admin users)):
```json
{
	"first_name": "<first_name>",
	"last_name": "<last_name>",
	"password": "<password>",
}
```

#### Delete Account

```
DELETE /users/
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "id": 3
}
```

</details>

**Deletes** the account that is making the request **except** if the account making the request is an account with `account_type` of `admin` and a `id` is given for the user that is to be deleted.

- **Dangerous Endpoint**
- may **delete** account making request
- admins may delete other accounts using `id`

#### Get Account

```
POST /users/info
authentication: bearer
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "username": "jannik"
}
```

</details>

Allows getting account details about a user. If the user that data is being requested for is one self or the account that is requesting the information is an admin full information is given, else only limited information is given.

- Requires Authorization
- Requires `username` or uses requesting account as username
- **Not** able to get details by id (this may change)

The response has the following JSON-structure:
```JSON
{
  "message": "retrieved user data successfully",
  "status": "success",
  "user": {
    "username": "<username>",
    "id": <id>,
    "first_name": "<first name>",
    "last_name": "<last name>",
    "email": "<email>",
    "creation_date": "<creation date>",
    "modification_date": "<modification date>",
    "account_type": "<account type (either admin, privileged or default)>",
    "metadata": <metadata>
  }
}
```

#### List Accounts

```
GET /users/list
authentication: bearer
```

Allows listing all users with one single request. No json or any other data needs to be given. This endpoint only works for accounts with high enough `account_type`. Minimum account type is `admin` (which is the highest).

- Requires admin privileges
- Does not require JSON body or data


### Login/Logout

#### Logout

```
POST /users/logout
authentication: bearer
```

Logs the request making account out. This does not invalidate Refresh-tokens, to accomplish something similar revoke access from every device using the `/device`-endpoint.

#### Login

```
POST /users/login
headers: "Content-Type": "application/json", "Device-Id": "{{ device_id  }}"
```


<details><summary>Example</summary>

```json
{
  "username": "{{ username  }}",
  "password": "{{ password  }}",
  "isRefreshToken": false,
  "getRefreshToken": false
}
```

</details>

Login

- requires `username`
- requires `password`
- optional: `isRefreshToken` & `getRefreshToken` (these are available via *Login (use Refresh-Token)* and *Login (get Refresh-Token)*)
- returnes JWT (`$.token`)
- may soon require some kind of 2fa verification code

#### Login (get Refresh-Token)

```
POST /users/login
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "username": "{{ username  }}",
  "password": "{{ password  }}",
  "isRefreshToken": false,
  "getRefreshToken": true
}
```

</details>

Login (get Refresh-Token)

- requires `username`
- requires `password`
- returnes JWT (`$.token`)
- returnes Refresh-Token (`$.refreshToken`)
- may soon require some kind of 2fa verification code

#### Login (use Refresh-Token)

```
POST /users/login
headers: "Content-Type": "application/json"
```


<details><summary>Example</summary>

```json
{
  "username": "{{ username  }}",
  "password": "{{ refreshToken  }}",
  "isRefreshToken": true,
  "getRefreshToken": false
}
```

</details>

Login (use Refresh-Token)

- requires `username`
- requires `password` (`refreshToken`)
- returnes JWT (`$.token`)
- uses Refresh-Token generated by *Login (get Refresh-Token*
- may soon require some kind of 2fa verification code




---

> documentation export date: 2019-07-02T21
> documentation auto generation date: 2019-07-02T21